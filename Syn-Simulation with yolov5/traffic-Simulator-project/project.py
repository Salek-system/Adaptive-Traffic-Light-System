from trafficSimulator import *
from yolov5 import *

# Create simulation
sim = Simulation()

# Add multiple roads
sim.create_roads([    
    ((0, 100), (144, 100), 120),     # 0
    ((144, 100), (294, 100), 100),   # 1
    # ==============================
    ((300, 0), (300, 88), 90),       # 2 #Upper street
    ((300, 88), (300, 188), 110),    # 3
    ((300, 188), (300, 294), 40),    # 4

    # =============================
    ((294, 100), (444, 100), 90),     # 5
    # ==============================
    ((444, 100), (594, 100), 89),     # 6

    # ===========Reverse Road==========
    # =================================
    ((606, 200), (465, 200), 120),     # 7  -1
    # =================================
    ((465, 200), (312, 200), 100),     # 8  -2
    # =================================    # Lower street
    ((312, 200), (162, 200), 90),      # 9  -3
    # =================================
    ((162, 200), (0, 200), 90),        # 10 -4
    # =================================
    ((454, 110), (454, 0), 90),        # 11
    ((454, 210), (454, 110), 110),     # 12 # Right street
    ((454, 306), (454, 210), 120),     # 13
    # =================================
    ((154, 110), (154, 0), 90),        # 14
    ((154, 210), (154, 110), 120),     # 15 # Left street
    ((154, 306), (154, 210), 110),     # 16
    # ==================================
])

sim.create_gen({
    'vehicle_rate': 20, 
    'vehicles': [
        [1, {"path": [0, 1, 5, 6]}],
        [1, {"path": [0, 14]}],
        [1, {"path": [0, 1, 3, 4]}],
        [2, {"path": [7, 8, 9, 10]}],
        [2, {"path": [7, 12, 11]}],
        [2, {"path": [7, 8, 9, 15, 14]}],
        [3, {"path": [2, 3, 4]}],
        [3, {"path": [2, 3, 9, 10]}],
        [3, {"path": [2, 5, 6]}],
        [4, {"path": [13, 12, 11]}],
        [5, {"path": [16, 15, 14]}],
    ]
})
sim.create_signal([[0], [15]], roads_ids=[0, 15])  # [0] r(50), g(120), [15] r(50) ,g(150)
sim.create_signal([[1], [2]], roads_ids=[1, 2])
sim.create_signal([[3], [8]], roads_ids=[3, 8])

sim.create_signal([[5], [12]], roads_ids=[5, 12])
sim.create_signal([[7], [13]], roads_ids=[7, 13])
sim.create_signal([[9], [16]], roads_ids=[9, 16])

# Start simulation
win = Window(sim)
win.offset = (-300, -110)

# win.run(steps_per_update=15)
win.run(steps_per_update=1000)
